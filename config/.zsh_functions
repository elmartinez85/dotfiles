# ============================================
# Custom Functions
# ============================================
# These functions are automatically loaded by .zshrc
# Edit this file to add your own custom functions

# ============================================
# Directory & File Management
# ============================================

# Create a directory and cd into it
mkcd() {
    mkdir -p "$1" && cd "$1"
}

# Go up N directories (e.g., up 3)
up() {
    local d=""
    local limit="${1:-1}"
    for ((i=1; i<=limit; i++)); do
        d="../$d"
    done
    cd "$d" || return
}

# Extract any archive type
extract() {
    if [ -f "$1" ]; then
        case "$1" in
            *.tar.bz2)   tar xjf "$1"     ;;
            *.tar.gz)    tar xzf "$1"     ;;
            *.bz2)       bunzip2 "$1"     ;;
            *.rar)       unrar x "$1"     ;;
            *.gz)        gunzip "$1"      ;;
            *.tar)       tar xf "$1"      ;;
            *.tbz2)      tar xjf "$1"     ;;
            *.tgz)       tar xzf "$1"     ;;
            *.zip)       unzip "$1"       ;;
            *.Z)         uncompress "$1"  ;;
            *.7z)        7z x "$1"        ;;
            *)           echo "'$1' cannot be extracted via extract()" ;;
        esac
    else
        echo "'$1' is not a valid file"
    fi
}

# ============================================
# Git Functions
# ============================================

# Quick commit with message
gcom() {
    git add --all
    git commit -m "$*"
}

# Quick commit and push
gcomp() {
    git add --all
    git commit -m "$*"
    git push
}

# Create a new branch and switch to it
gnb() {
    git checkout -b "$1"
}

# Delete local and remote branch
gdb() {
    git branch -d "$1"
    git push origin --delete "$1"
}

# Git clone and cd into directory
gclone() {
    git clone "$1" && cd "$(basename "$1" .git)" || return
}

# ============================================
# Development Helpers
# ============================================

# Find process using a specific port
port() {
    lsof -i ":$1"
}

# Kill process on specific port
killport() {
    lsof -ti ":$1" | xargs kill -9
}

# Create a backup of a file
backup() {
    cp "$1"{,.backup-$(date +%Y%m%d-%H%M%S)}
}

# ============================================
# Network & System Info
# ============================================

# Get all IP addresses
myips() {
    echo "Public IP:  $(curl -s ifconfig.me)"
    echo "Local IP:   $(ipconfig getifaddr en0)"
    echo "Router IP:  $(netstat -nr | grep default | awk '{print $2}' | head -n 1)"
}

# Test website response time
pingweb() {
    curl -o /dev/null -s -w "DNS: %{time_namelookup}s\nConnect: %{time_connect}s\nTotal: %{time_total}s\n" "$1"
}

# ============================================
# File Search & Content
# ============================================

# Find files by name (using fd command if available, otherwise find)
ff() {
    if command -v fd &> /dev/null; then
        command fd --type f "$1"
    else
        find . -type f -iname "*$1*"
    fi
}

# Find directories by name (renamed to avoid conflict with fd command)
fdir() {
    if command -v fd &> /dev/null; then
        command fd --type d "$1"
    else
        find . -type d -iname "*$1*"
    fi
}

# Search for text in files (using ripgrep if available, otherwise grep)
search() {
    if command -v rg &> /dev/null; then
        rg "$@"
    else
        grep -r "$@" .
    fi
}

# ============================================
# Productivity & Utilities
# ============================================

# Create a timestamped note file
note() {
    local note_file="$HOME/Documents/notes-$(date +%Y%m%d-%H%M%S).md"
    echo "# Note - $(date '+%Y-%m-%d %H:%M:%S')" > "$note_file"
    echo "" >> "$note_file"
    echo "$*" >> "$note_file"
    codium "$note_file"
}

# Weather report
weather() {
    local location="${1:-}"
    curl "wttr.in/${location}"
}

# QR code generator (encode text to QR in terminal)
qr() {
    curl "qrenco.de/$*"
}

# ============================================
# macOS Specific Functions
# ============================================

# Open current directory in Finder
finder() {
    open -a Finder "${1:-.}"
}

# Copy current directory path to clipboard
cpwd() {
    pwd | tr -d '\n' | pbcopy
    echo "Current directory path copied to clipboard"
}

# Copy file contents to clipboard
ccat() {
    if [ -f "$1" ]; then
        cat "$1" | pbcopy
        echo "File contents copied to clipboard"
    else
        echo "File not found: $1"
    fi
}

# ============================================
# Node/NPM Functions
# ============================================

# Initialize a new npm project with defaults
npminit() {
    npm init -y
}

# ============================================
# Python Functions
# ============================================

# Create and activate a virtual environment
venv() {
    python3 -m venv venv
    source venv/bin/activate
}

# Activate existing virtual environment
vact() {
    if [ -d "venv" ]; then
        source venv/bin/activate
    elif [ -d ".venv" ]; then
        source .venv/bin/activate
    else
        echo "No virtual environment found"
    fi
}
